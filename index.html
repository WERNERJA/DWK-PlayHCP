<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>De Woeste Kop - Playing Handicap</title>

  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/qrcodejs/qrcode.min.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(to bottom, #f0f4f8, #dfe9f3);
      padding: 2rem;
      max-width: 700px;
      margin: auto;
      text-align: center;
    }
    h1 {
      color: #2c3e50;
      margin-bottom: 0.5rem;
    }
    .logo {
      width: 120px;
      margin-bottom: 1rem;
    }
    .section {
      margin-bottom: 2rem;
    }
    .label {
      font-weight: bold;
      margin-bottom: 0.5rem;
      display: block;
    }
    input[type="text"] {
      width: 100px;
      padding: 0.4rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      text-align: center;
    }
    .button-group {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 0.5rem;
      margin-top: 1rem;
    }
    .btn {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: white;
      min-width: 100px;
      transition: transform 0.2s ease;
    }
    .btn:hover {
      transform: scale(1.05);
    }
    .btn.selected {
      box-shadow: 0 0 0 3px #2c3e50;
    }
    .btn-wit { background-color: #cccccc; color: black; }
    .btn-geel { background-color: #f1c40f; }
    .btn-blauw { background-color: #3498db; }
    .btn-rood { background-color: #e74c3c; }
    .btn-oranje { background-color: #e67e22; }
    .btn-heer { background-color: #2c3e50; }
    .btn-dame { background-color: #8e44ad; }
    .btn-lus { background-color: #16a085; }
    .btn-action { background-color: #0077cc; margin-top: 1rem; }
    .error {
      color: red;
      margin-top: 1rem;
    }
    .result-box {
      background-color: #ffffff;
      border-radius: 8px;
      padding: 1.5rem;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-top: 2rem;
    }
    .result-title {
      font-size: 1.5rem;
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 1rem;
    }
    .result-details {
      font-size: 1rem;
      color: #34495e;
      line-height: 1.6;
      white-space: pre-line;
    }
    .qr {
      margin-top: 2rem;
    }
  </style>
</head>
<body>
  <img src="logoDWK.png" alt="Logo De Woeste Kop" class="logo" />
  <h1>De Woeste Kop</h1>
  <div id="app"></div>
  <div id="qr" class="qr"></div>

  <script type="text/javascript">
    const { useState, useEffect } = React;

    function roundHalfUp(x) {
      const abs = Math.abs(x);
      const intPart = Math.floor(abs);
      const frac = abs - intPart;
      let rounded = frac >= 0.5 ? intPart + 1 : intPart;
      return x < 0 ? -rounded : rounded;
    }

    function computePlayingHandicap(hi, par, cr, sr, allowance = 1.0, lus = '') {
      // âœ… Halveer de Handicap Index eerst bij 9-holes
      const adjustedHi = lus.startsWith('9_') ? hi / 2 : hi;
    
      // Bereken Course Handicap
      const ch = adjustedHi * (sr / 113.0) + (cr - par);
    
      // Bereken Playing Handicap
      const ph = ch * allowance;
    
      // âœ… Afronden volgens round half up
      return roundHalfUp(ph);
    }


    const TEE_OPTIONS = {
      heer: [
        { key: 'wit', label: 'Wit', class: 'btn-wit' },
        { key: 'geel', label: 'Geel', class: 'btn-geel' },
        { key: 'blauw', label: 'Blauw', class: 'btn-blauw' },
        { key: 'rood', label: 'Rood', class: 'btn-rood' },
        { key: 'oranje', label: 'Oranje', class: 'btn-oranje' },
      ],
      dame: [
        { key: 'geel', label: 'Geel', class: 'btn-geel' },
        { key: 'blauw', label: 'Blauw', class: 'btn-blauw' },
        { key: 'rood', label: 'Rood', class: 'btn-rood' },
        { key: 'oranje', label: 'Oranje', class: 'btn-oranje' },
      ]
    };

    const LUS_OPTIONS = [
      { key: '18', label: '18 holes' },
      { key: '9_watertoren', label: '9 holes Watertoren' },
      { key: '9_grote_kreek', label: '9 holes De Grote Kreek' },
    ];

    function App() {
      const [step, setStep] = useState(1);
      const [hi, setHi] = useState('');
      const [gender, setGender] = useState('');
      const [tee, setTee] = useState('');
      const [lus, setLus] = useState('');
      const [data, setData] = useState(null);
      const [error, setError] = useState('');
      const [result, setResult] = useState(null);

      useEffect(() => {
        fetch('dwk-course-data.json')
          .then(res => res.json())
          .then(json => setData(json))
          .catch(err => setError('Kan dwk-course-data.json niet laden'));
      }, []);

      useEffect(() => {
        const el = document.getElementById('qr');
        if (!el) return;
        el.innerHTML = '';
        try {
          new QRCode(el, { text: window.location.href, width: 96, height: 96 });
        } catch (e) {}
      }, []);

      function goToStep2() {
        setError('');
        const val = parseFloat(hi);
        const validFormat = /^\d{1,2}\.\d$/.test(hi);
        if (!validFormat || isNaN(val) || val < -10 || val > 54) {
          setError('Geef een geldige handicap index (bv. 14.3)');
          return;
        }
        if (!gender) {
          setError('Kies geslacht');
          return;
        }
        if (!data) {
          setError('Course data niet beschikbaar');
          return;
        }
        setStep(2);
      }

      function performCompute() {
        setError('');
        if (!tee || !lus) {
          setError('Kies tee-box en lus');
          return;
        }
        const g = data?.[gender];
        const t = g?.[tee];
        const seg = t?.[lus];
        if (!seg) {
          setError(`Ontbrekende data voor ${gender}/${tee}/${lus}`);
          return;
        }
        const par = Number(seg.par);
        const cr = Number(seg.cr);
        const sr = Number(seg.sr);
        const hiVal = parseFloat(hi);
        if ([par, cr, sr].some(v => isNaN(v))) {
          setError('Ongeldige course parameters');
          return;
        }
        const ph = computePlayingHandicap(hiVal, par, cr, sr, 1.0, lus);
        setResult({ ph, par, cr, sr, hi: hiVal, gender, tee, lus });
        setStep(3);
      }

      function resetAll() {
        setStep(1);
        setHi('');
        setGender('');
        setTee('');
        setLus('');
        setError('');
        setResult(null);
      }

      const elements = [];

      if (step === 1) {
        elements.push(
          React.createElement("div", { className: "section" },
            React.createElement("span", { className: "label" }, "Vul je handicap index in:"),
            React.createElement("input", {
              type: "text",
              value: hi,
              onChange: e => setHi(e.target.value),
              placeholder: "bv. 14.3"
            })
          ),
          React.createElement("div", { className: "section" },
            React.createElement("div", { className: "button-group" },
              React.createElement("button", {
                className: `btn btn-heer${gender === 'heer' ? ' selected' : ''}`,
                onClick: () => setGender('heer')
              }, "Heer"),
              React.createElement("button", {
                className: `btn btn-dame${gender === 'dame' ? ' selected' : ''}`,
                onClick: () => setGender('dame')
              }, "Dame")
            )
          ),
          React.createElement("button", {
            className: "btn btn-action",
            onClick: goToStep2
          }, "Volgende")
        );
      }

      if (step === 2) {
        const teeOptions = TEE_OPTIONS[gender] || [];
        elements.push(
          React.createElement("div", { className: "section" },
            React.createElement("span", { className: "label" }, "Kies je tee-box:"),
            React.createElement("div", { className: "button-group" },
              ...teeOptions.map(opt =>
                React.createElement("button", {
                  key: opt.key,
                  className: `btn ${opt.class}${tee === opt.key ? ' selected' : ''}`,
                  onClick: () => setTee(opt.key)
                }, opt.label)
              )
            )
          ),
          React.createElement("div", { className: "section" },
            React.createElement("span", { className: "label" }, "Kies je lus:"),
            React.createElement("div", { className: "button-group" },
              ...LUS_OPTIONS.map(opt =>
                React.createElement("button", {
                  key: opt.key,
                  className: `btn btn-lus${lus === opt.key ? ' selected' : ''}`,
                  onClick: () => setLus(opt.key)
                }, opt.label)
              )
            )
          ),
          React.createElement("button", {
            className: "btn btn-action",
            onClick: performCompute
          }, "Bereken")
        );
      }

      if (step === 3 && result) {
        elements.push(
          React.createElement("div", { className: "result-box" },
            React.createElement("div", { className: "result-title" }, `ðŸŽ¯ Playing Handicap: ${result.ph}`),
            React.createElement("div", { className: "result-details" },
              `Handicap Index: ${result.hi}\n` +
              `Geslacht: ${result.gender}\n` +
              `Tee-box: ${result.tee}\n` +
              `Lus: ${result.lus}\n` +
              `Par: ${result.par}, CR: ${result.cr}, SR: ${result.sr}`
            ),
            React.createElement("button", {
              className: "btn btn-action",
              onClick: resetAll
            }, "Opnieuw")
          )
        );
      }

      if (error) {
        elements.push(React.createElement("div", { className: "error" }, error));
      }

      return React.createElement("div", null, ...elements);
    }

    const root = ReactDOM.createRoot(document.getElementById("app"));
    root.render(React.createElement(App));
  </script>
</body>
</html>
